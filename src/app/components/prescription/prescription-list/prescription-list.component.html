<h2>Prescriptions</h2>

<div class="flex-container">
  <div class="flex-item">
    <p-dropdown 
  [options]="filteredMedics" 
  [(ngModel)]="selectedDoctor" 
  optionLabel="name" 
  [filter]="true" 
  filterBy="name,lastname,cjp,email" 
  [showClear]="true"
  placeholder="Select a Doctor"
  styleClass="w-20rem"
  (onChange)="onDoctorSelect($event)">
  <ng-template pTemplate="filter" let-options="options">
    <div class="flex gap-1">
      <div class="p-inputgroup" (click)="$event.stopPropagation()">
        <span class="p-inputgroup-addon"><i class="pi pi-search"></i></span>
        <input 
          type="text"
          pInputText
          placeholder="Filter"
          [(ngModel)]="filterValueMedic"
          (keyup)="customFilterMedic($event, options)" />
      </div>
    </div>
  </ng-template>
  <ng-template pTemplate="selectedItem" let-selectedOption>
    <div class="flex align-items-center gap-2">
      <div>{{ selectedOption.name }} {{ selectedOption.lastname }} | {{selectedOption.email }} | {{selectedOption.cjp }}</div>
    </div>
  </ng-template>
  <ng-template let-medic pTemplate="item">
    <div class="flex align-items-center gap-2">
      <div>{{ medic.name }} {{ medic.lastname }} | {{ medic.email }} | {{ medic.cjp }}</div>
    </div>
  </ng-template>
</p-dropdown>
  </div>
  
  <div class="flex-item">
    <p-dropdown 
      [options]="filteredPatients" 
      [(ngModel)]="selectedPatient" 
      optionLabel="name" 
      [filter]="true" 
      filterBy="name,lastname,document,email" 
      [showClear]="true"
      placeholder="Select a Patient"
      styleClass="w-20rem"
      (onChange)="onPatienSelect($event)">
      <ng-template pTemplate="filter" let-options="options">
        <div class="flex gap-1">
          <div class="p-inputgroup" (click)="$event.stopPropagation()">
            <span class="p-inputgroup-addon"><i class="pi pi-search"></i></span>
            <input 
              type="text"
              pInputText
              placeholder="Filter"
              [(ngModel)]="filterValuePatien"
              (keyup)="customFilterPatien($event, options)" />
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="selectedItem" let-selectedOption>
        <div class="flex align-items-center gap-2">
          <div>{{ selectedOption.name }} {{ selectedOption.lastname }} | {{selectedOption.email }} | {{selectedOption.document }}</div>
        </div>
      </ng-template>
      <ng-template let-patient pTemplate="item">
        <div class="flex align-items-center gap-2">
          <div>{{ patient.name }} {{ patient.lastname }} | {{ patient.email }} | {{ patient.document }}</div>
        </div>
      </ng-template>
    </p-dropdown>
  </div>
  
  <div class="flex-item">
    <p-calendar 
      [(ngModel)]="rangeDates" 
      dateFormat="yy-mm-dd"
      selectionMode="range" 
      [showIcon]="true" 
      [readonlyInput]="true"
      (onSelect)="onDateSelect()"/>
  </div>
</div>


<p-table [value]="prescriptions" [paginator]="true" [rows]="15" [totalRecords]="totalRecords" [lazy]="true"
         (onLazyLoad)="loadPrescriptions($event)" [loading]="loading">
  <ng-template pTemplate="header">
    <tr>
      <th>createdAt</th>
      <th>code</th>
      <th>patientDocument</th>
      <th>patientName</th>
      <th>patientLastname</th>
      <th>medicCjp</th>
      <th>medicName</th>
      <th>medicLastname</th>
      <th>status</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-prescription>
    <tr>
      <td>{{ prescription.createdAt }}</td>
      <td>{{ prescription.code }}</td>
      <td>{{ prescription.patientDocument?.number }}</td>
      <td>{{ prescription.patientName }}</td>
      <td>{{ prescription.patientLastname }}</td>
      <td>{{ prescription.medicCjp }}</td>
      <td>{{ prescription.medicName }}</td>
      <td>{{ prescription.medicLastname }}</td>
      <td>{{ prescription.status }}</td>
    </tr>
  </ng-template>
</p-table>
